{
    "contents" : "---\ntitle: \"Health and economic impact of weather events in the US from 1950 to 2011\"\noutput: html_document\n---\n\n## Synopsis\nSevere and extreme weather events such as storms, floods and tornados can result in fatalities, injuries and economic losses. Using data form the US National Oceanic and Atmospheric Administration's - NOAA - it is possible to categorize these extreme events in order to analyze them, quantify their costs and explore their evolution over time. This report categorizes the impact of major weather events in the United States from 1950 to 2011.\n\n## Data processing\nThe full data set is available [here](https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2). It includes 902,297 observations on 37 variables. However, not all of them are required for the purpose of this analysis, therefore a new data frame will be created containing the 8 variables needed. Within this new data set a new variable will be created using the date of the original event to display only the year.\n```{r read data}\n# Read in data\nstorm_data <- read.csv(\"repdata_data_StormData.csv.bz2\", stringsAsFactors = FALSE)\n# Set all variable names to lower caps\nnames(storm_data) <- tolower(names(storm_data))\n```\n\n\n```{r new data frame}\n# Create a new data frame using only the variables needed\ndata <- subset(storm_data, select=c(\"bgn_date\", \"evtype\", \"fatalities\", \"injuries\",\n                                    \"propdmg\", \"propdmgexp\", \"cropdmg\", \"cropdmgexp\"))\n\n# Extract the year to another variable\ndata$year <- as.numeric(substr(strptime(storm_data$bgn_date, \"%m/%d/%Y\"), 0, 4))\n```\n\nThere are 985 different categories of event types in the data set. However, after looking at their values it becomes clear that they can be regrouped into smaller groups. This is due to the fact that the categorization of events does not follow a strict system. There are clarifications, abbreviations and typos that capture the same event, for example thunderstorms are referred to as \"THUNDERSTORMS\", \"GUSTY THUNDERSTORM WIND\" and \"TSTM\". To reduce the number of categories regular expressions can be used first to determine key words associated with different events and second to rename the event type field.  \n\nFor example, keywords like \"rain\", \"storm\" and \"shower\" can be used to determine a storm event that can be renamed simply \"Rain\" in all cases. Likewise, occurrences of the strings \"flood\", \"flooo\", \"fld\" and \"stream\" can be renamed simply \"Flood\".\n\nAfter examining the different event types collected we can re-assigned them to one of 8 groups that correspond to the most common event types, while those that did not correspond to any of the new created categories where assigned to \"Other\". This results in an oversimplification of facts but it is necessary to provide an initial overall understanding that could be later expanded by analzying specific cases alone.\n```{r regrouping event types}\nthunderstorm <- grepl(\"thunder|thude|tstm\", ignore.case = TRUE, data$evtype)\ndata$evtype <- ifelse(thunderstorm == TRUE, \"Thunderstorm\", data$evtype)\n\nflood <- grepl(\"flood|flooo|fld|stream\", ignore.case = TRUE, data$evtype)\ndata$evtype <- ifelse(flood == TRUE, \"Flood\", data$evtype)\n\ntornado <- grepl(\"tornado|torndao\", ignore.case = TRUE, data$evtype)\ndata$evtype <- ifelse(tornado == TRUE, \"Tornado\", data$evtype)\n\nrain <- grepl(\"rain|storm|shower\", ignore.case = TRUE, data$evtype)\ndata$evtype <- ifelse(rain == TRUE, \"Rain\", data$evtype)\n\nwind <- grepl(\"wind|gust|hurr|typ\", ignore.case = TRUE, data$evtype)\ndata$evtype <- ifelse(wind == TRUE, \"Wind\", data$evtype)\n\nheat <- grepl(\"heat|warm|hot|dry|drought|high\", ignore.case = TRUE, data$evtype)\ndata$evtype <- ifelse(heat == TRUE, \"Hot weather\", data$evtype)\n\ncold <- grepl(\"cold|chill|freez|ice|icy|snow|wint|blizzard|cool|frost|low\", ignore.case = TRUE, data$evtype)\ndata$evtype <- ifelse(cold == TRUE, \"Cold weather\", data$evtype)\n\nfire <- grepl(\"fire|smoke\", ignore.case = TRUE, data$evtype)\ndata$evtype <- ifelse(fire == TRUE, \"Fire\", data$evtype)\n\n# Group all other events into 'other'\nclean_events <- c(\"Thunderstorm\", \"Flood\", \"Tornado\", \"Rain\", \"Wind\",\"Hot weather\", \"Cold weather\", \"Fire\")\ndata$evtype <-ifelse(data$evtype %in% clean_events, data$evtype, \"Other\")\n```\n\nWhile fatalities and injuries have been entered using actual figures, property and crop damages must be converted to their actual figure using the variable 'propdmgexp' and 'cropdmgexp' respectively. These variables consist, except in a few cases that will be overlooked here, of a string character that determines whether the figure provided corresponds to hundreds, \"H\", thousands, \"K\", millions, \"M\" or billions, \"B\". Combining these we can get the actual property and damage figures, as well as create a variable that sums them together, \"total_losses\".\n```{r totalling property and crops damages}\n# Property and crops damage totals\ndata$prop_total_damage <- ifelse(data$propdmgexp==\"H\"|data$propdmgexp==\"h\", data$propdmg * 100,\n                                 ifelse(data$propdmgexp==\"K\", data$propdmg * 1000,\n                                        ifelse(data$propdmgexp==\"M\"|data$propdmgexp==\"m\", data$propdmg * 1000000,\n                                               ifelse(data$propdmgexp==\"B\", data$propdmg * 1000000000, data$propdmg))))\n\ndata$crop_total_damage <- ifelse(data$cropdmgexp==\"k\", data$cropdmg * 1000,\n                                 ifelse(data$cropdmgexp==\"K\", data$cropdmg * 1000,\n                                        ifelse(data$cropdmgexp==\"M\", data$cropdmg * 1000000,\n                                               ifelse(data$cropdmgexp==\"m\", data$cropdmg * 1000000, data$cropdmg))))\n\ndata$total_losses <- data$prop_total_damage + data$crop_total_damage\n```\n\nWe can then proceed to create to grouped sets of data, one by event type and year and another one only by event types.\n```{r grouping variables}\nlibrary(dplyr)\nevtype_year_groups <- group_by(data, year, evtype)\n\nevtype_year_data <- summarise(evtype_year_groups,\n                          n = n())\n\nevtype_groups <- group_by(data, evtype)\n\nevtype_data <- summarise(evtype_groups,\n                          fatalities = sum(fatalities),\n                          injuries = sum(injuries),\n                          propdmg = sum(prop_total_damage),\n                          cropdmg = sum(crop_total_damage),\n                          totaldmg = sum(total_losses),\n                          n = n())\n```\n\n## Results\n\n### Most harmful events to population health\nTornados are by far the most dangerous weather events in the US. In the 60,700 tornados registered from 1950 until 2011 91,407 people have been injured and 5636 have died. 65% of all injuries caused by weather events are the result of tornados, while the next major cause of injuries, rain, represents only 10%. In terms of fatalities, however, tornados represent 37.2% of deaths, followed by 22% caused by hot weather.\n\n```{r population health, fig.align='center', fig.width=10, fig.height=3.5}\n# Factor the event type variable and arrange the levels.\nevtype_data$evtype <- factor(evtype_data$evtype, levels = c(\"Other\", \"Fire\",\"Wind\",\n                                                            \"Cold weather\", \"Flood\", \"Hot weather\",\n                                                            \"Rain\", \"Tornado\"))\n\nlibrary(ggplot2)\nlibrary(gridExtra)\ninjuries = ggplot(evtype_data, aes(x=evtype, y=injuries)) +\n        geom_bar(stat=\"identity\", fill=\"#45b188\") +\n        coord_flip() +\n        ylab(\"\") +\n        xlab(\"\") +\n        ggtitle(\"Injuries\")\n\nfatalities = ggplot(evtype_data, aes(x=evtype, y=fatalities)) +\n        geom_bar(stat=\"identity\", fill=\"steelblue\") +\n        coord_flip() +\n        ylab(\"\") +\n        xlab(\"\") +\n        ggtitle(\"Fatalities\")\n\ngrid.arrange(injuries, fatalities, ncol=2, main = \"Total number of people affected 1950 - 2011\")\n```\n\n\n### Economic consequences of weather events\nIn economic terms floods have been the major cause of losses from 1950 to 2011. 86,136 floods have been reported in the period 1950 to 2011 and while they have caused damages in the crops valued in 7,4 billion dollars, the resulting property damages reach 167 billion dollars. 37.8% of all economic losses are caused by floods, while 20.8% have been caused by wind, including hurricanes and typhoons. Rains, which are a major cause of floods have caused around 18.4% of all economic losses.\n```{r economic consequences, fig.width=15, fig.height=10}\n# Factor the event type variable and arrange the levels.\nevtype_data$evtype <- factor(evtype_data$evtype, levels = c(\"Other\", \"Cold weather\", \"Fire\", \"Hot weather\", \"Tornado\",\n                                                            \"Rain\", \"Wind\", \"Flood\"))\n\nproperty = ggplot(evtype_data, aes(x=evtype, y=propdmg/1000000000)) +\n        geom_bar(stat=\"identity\", fill=\"#45b188\") +\n        coord_flip() +\n        ylab(\"Billion dollars\") +\n        xlab(\"\") +\n        ggtitle(\"Property damages\")\n\ncrops = ggplot(evtype_data, aes(x=evtype, y=cropdmg/1000000000)) +\n        geom_bar(stat=\"identity\", fill=\"steelblue\") +\n        coord_flip() +\n        ylab(\"Billion dollars\") +\n        xlab(\"\") +\n        ggtitle(\"Crop damages\")\n\ntotal = ggplot(evtype_data, aes(x=evtype, y=totaldmg/1000000000)) +\n        geom_bar(stat=\"identity\", fill=\"#224158\") +\n        coord_flip() +\n        ylab(\"Billion dollars\") +\n        xlab(\"\") +\n        ggtitle(\"Total damages\")\n\n# Print several plots thanks to 'A guest': http://pastebin.com/skwdmEjZ\npushViewport(viewport(layout = grid.layout(3, 2, heights = unit(c(0.5, 5, 5), \"null\"))))\n\nprint(property, vp = viewport(layout.pos.row = 2, layout.pos.col = 1))\nprint(crops, vp = viewport(layout.pos.row = 2, layout.pos.col = 2))\nprint(total, vp = viewport(layout.pos.row = 3, layout.pos.col = 1:2))\ngrid.text(\"Economic costs of weather events 1950 - 2011\", vp = viewport(layout.pos.row = 1, layout.pos.col = 1:2))\n```\n\n### Event frequency\nAlthough not all weather events have been registered since 1950 it is very noticeable the increase in rain, floods and wind type of events in the past twenty years. Tornados display a much more stable pattern, although they also seem to increase in the latest years along with cold weather.\n```{r event frequency, fig.width=10, fig.height=5}\nggplot(evtype_year_data, aes(x=year, y=n, color=evtype)) +\n        geom_line() +\n        scale_colour_brewer(palette=\"Set1\") +\n        xlab(\"Year\") +\n        ylab(\"Occurrences\") +\n        ggtitle(\"Evolution of weather events 1950 - 2011\") +\n        scale_x_continuous(breaks=seq(1950, 2011, 5))\n```",
    "created" : 1411128269090.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3604890687",
    "id" : "3A64F9D0",
    "lastKnownWriteTime" : 1412091250,
    "path" : "~/Cloud Drive/Online Education/Data Science Specialization/5 - Reproducible Research/PA_2/PA_2.Rmd",
    "project_path" : "PA_2.Rmd",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}